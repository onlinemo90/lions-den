{% extends 'ticket_system/base.html' %}

{% block content %}
	<div class="row"> {# Ticket Info header #}
		<div class="col-9 border shadow">
			<div class="my-2">
				<h2>{{ object.title }}</h2>
			</div>
			<div class="row my-4 text-center">
				<div class="col-3 center">
					<p><b>Status:</b> {{ object.get_status_display}}</p>
				</div>
				<div class="col-3 center">
					<p><b>Type:</b> {{ object.get_type_display }}</p>
				</div>
				<div class="col-3 center">
					<p><b>Priority:</b> {{ object.get_priority_display }}</p>
				</div>
				<div class="col-3 center">
					<p><b>Action:</b> {{ object.get_action_display }}</p>
				</div>
			</div>
			<div class="mx-2 my-4">
				<p style="white-space:pre">{{ object.description }}</p>
			</div>
		</div>
		
		<div class="col-3 border container-fluid shadow small">
			<div class="row border-bottom my-3">
				<div class="container">
					<p><strong>Created by:</strong> {{ object.reporter }}</p>
					<p><strong>Assigned to:</strong> {{ object.assignee|default:'---' }}</p>
				</div>
			</div>
			<div class="row my-3">
				<div class="container">
					<p><strong>Created on:</strong> {{ object.created_date }}</p>
					<p><strong>Last updated on:</strong> {{ object.last_updated_date }}</p>
					{% if object.closed_date %}<p><strong>Closed on:</strong> {{ object.closed_date }}</p>{% endif %}
				</div>
			</div>
		</div>
	</div>
	
	{% if object.comments.all %}
		<div class="mt-4">
			<h4 style="color:var(--colorPrimaryDark)">Comments</h4>
			<div class="small">
				{% for comment in object.comments.all %}
					<div class="card shadow mb-2">
						<div class="card-header">
							<b>{{ comment.creator }}</b> commented on {{ comment.added_date }}
						</div>
						<div class="card-body">
							{{ comment.text }}
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	{% endif %}
	<a type="button" class="btn btn-primary mt-4" onclick="getModal('modal_new_comment')">Add a comment</a>

{% endblock %}

{% block extra_navbar_items %}
	{{ block.super }}
	<li class="nav-item dropdown">
		<div id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			{% include 'utils/buttons/edit.html' with css_class='navbar-image mr-3' stroke='var(--colorBackground)' %}
		</div>
		<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
			<a class="dropdown-item" href="#" onclick="getModal('modal_edit_ticket')">Edit Ticket</a>
			{% if request.user.is_staff %}
				<a class="dropdown-item" href="#" onclick="getModal('modal_assign_ticket')">{% if ticket.assignee %}Re-assign{% else %}Assign{% endif %} Ticket</a>
			{% endif %}
			{% if request.user.id == object.assignee.id %}
				<a class="dropdown-item" href="#" onclick="getModal('modal_update_ticket')">Update Ticket</a>
			{% endif %}
		</div>
	</li>
{% endblock %}